{"version":3,"file":"bundle.esm.js","sources":["../src/index.js"],"sourcesContent":["import { promisify } from 'util';\n\nfunction wrapAct() {\n  if (!this.seneca) {\n    throw new Error('no seneca found');\n  }\n\n  if (!global.Errors) {\n    throw new Error('no global Errors found');\n  }\n\n  let act = promisify(this.seneca.act.bind(this.seneca));\n\n  // expose global promise act\n  global.act = async function actAsync(msg, ...args) {\n    if (global.als) {\n      let traceId = global.als.get('traceId');\n      msg.traceId = msg.traceId === undefined ? traceId : msg.traceId;\n    }\n\n    let result = await act(msg, ...args);\n    if (result && result.errcode) {\n      if (!Errors[result.errcode]) {\n        throw new Error(`no error name found ${result.errcode} for ${result.errmsg}`);\n      }\n      throw new Errors[result.errcode](result.extra);\n    }\n    return result;\n  };\n}\n\nexport default wrapAct;\n"],"names":["wrapAct","seneca","Error","global","Errors","act","promisify","bind","actAsync","msg","args","als","traceId","get","undefined","result","errcode","errmsg","extra"],"mappings":";;AAEA,SAASA,OAAT,GAAmB;MACb,CAAC,KAAKC,MAAV,EAAkB;UACV,IAAIC,KAAJ,CAAU,iBAAV,CAAN;;;MAGE,CAACC,OAAOC,MAAZ,EAAoB;UACZ,IAAIF,KAAJ,CAAU,wBAAV,CAAN;;;MAGEG,MAAMC,UAAU,KAAKL,MAAL,CAAYI,GAAZ,CAAgBE,IAAhB,CAAqB,KAAKN,MAA1B,CAAV,CAAV,CATiB;;SAYVI,GAAP,GAAa,eAAeG,QAAf,CAAwBC,GAAxB,EAA6B,GAAGC,IAAhC,EAAsC;QAC7CP,OAAOQ,GAAX,EAAgB;UACVC,UAAUT,OAAOQ,GAAP,CAAWE,GAAX,CAAe,SAAf,CAAd;UACID,OAAJ,GAAcH,IAAIG,OAAJ,KAAgBE,SAAhB,GAA4BF,OAA5B,GAAsCH,IAAIG,OAAxD;;;QAGEG,SAAS,MAAMV,IAAII,GAAJ,EAAS,GAAGC,IAAZ,CAAnB;;QACIK,UAAUA,OAAOC,OAArB,EAA8B;UACxB,CAACZ,OAAOW,OAAOC,OAAd,CAAL,EAA6B;cACrB,IAAId,KAAJ,CAAW,uBAAsBa,OAAOC,OAAQ,QAAOD,OAAOE,MAAO,EAArE,CAAN;;;YAEI,IAAIb,OAAOW,OAAOC,OAAd,CAAJ,CAA2BD,OAAOG,KAAlC,CAAN;;;WAEKH,MAAP;GAbF;;;;;"}