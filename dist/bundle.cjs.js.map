{"version":3,"file":"bundle.cjs.js","sources":["../src/index.js"],"sourcesContent":["import { promisify } from 'util';\n\nfunction wrapAct() {\n  if (!this.seneca) {\n    throw new Error('no seneca found');\n  }\n\n  if (!global.Errors) {\n    throw new Error('no global Errors found');\n  }\n\n  let act = promisify(this.seneca.act, { context: this.seneca });\n\n  // expose global promise act\n  global.act = async function actAsync(msg, ...args) {\n    if (global.als) {\n      let traceId = global.als.get('traceId');\n      msg.traceId = msg.traceId === undefined ? traceId : msg.traceId;\n    }\n\n    let result = await act(msg, ...args);\n    if (result && result.errcode) {\n      if (!Errors[result.errcode]) {\n        throw new Error(`no error name found ${result.errcode} for ${result.errmsg}`);\n      }\n      throw new Errors[result.errcode](result.extra);\n    }\n    return result;\n  };\n}\n\nexport default wrapAct;\n"],"names":["wrapAct","seneca","Error","global","Errors","act","promisify","actAsync","msg","args","als","traceId","get","undefined","result","errcode","errmsg","extra"],"mappings":";;;;AAEA,SAASA,OAAT,GAAmB;MACb,CAAC,KAAKC,MAAV,EAAkB;UACV,IAAIC,KAAJ,CAAU,iBAAV,CAAN;;;MAGE,CAACC,OAAOC,MAAZ,EAAoB;UACZ,IAAIF,KAAJ,CAAU,wBAAV,CAAN;;;MAGEG,MAAMC,eAAU,KAAKL,MAAL,CAAYI,GAAtB,EAA2B;aAAW,KAAKJ;GAA3C,CAAV,CATiB;;SAYVI,GAAP,GAAa,eAAeE,QAAf,CAAwBC,GAAxB,EAA6B,GAAGC,IAAhC,EAAsC;QAC7CN,OAAOO,GAAX,EAAgB;UACVC,UAAUR,OAAOO,GAAP,CAAWE,GAAX,CAAe,SAAf,CAAd;UACID,OAAJ,GAAcH,IAAIG,OAAJ,KAAgBE,SAAhB,GAA4BF,OAA5B,GAAsCH,IAAIG,OAAxD;;;QAGEG,SAAS,MAAMT,IAAIG,GAAJ,EAAS,GAAGC,IAAZ,CAAnB;;QACIK,UAAUA,OAAOC,OAArB,EAA8B;UACxB,CAACX,OAAOU,OAAOC,OAAd,CAAL,EAA6B;cACrB,IAAIb,KAAJ,CAAW,uBAAsBY,OAAOC,OAAQ,QAAOD,OAAOE,MAAO,EAArE,CAAN;;;YAEI,IAAIZ,OAAOU,OAAOC,OAAd,CAAJ,CAA2BD,OAAOG,KAAlC,CAAN;;;WAEKH,MAAP;GAbF;;;;;"}